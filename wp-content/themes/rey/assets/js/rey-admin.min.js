!function(i){"use strict";var e=i(".rey-dashboard-main");void 0!==i.fn.masonry&&e.masonry({itemSelector:".rey-dashBox"});var n=function(e,r,a){if(e&&r&&a){var s={value:r,expires_at:(new Date).getTime()+a/1};localStorage.setItem(e.toString(),JSON.stringify(s))}},t=function(e){if(!e)return null;var r=JSON.parse(localStorage.getItem(e.toString()));if(null!==r){if(!(null!==r.expires_at&&r.expires_at<(new Date).getTime()))return r.value;localStorage.removeItem(e.toString())}return null};i(".js-storeNotice").each(function(e,r){var a=i(r),s="rey-notice-"+a.attr("data-from");t(s)&&a.hide(),i(".notice-dismiss",a).on("click",function(e){a.hide(),n(s,!0,432e5)})}),i('<li class="rey-refresh-plugins"><a href="'+reyAdminParams.refresh_plugins_url+'">'+reyAdminParams.refresh_plugins_text+"</a></li>").appendTo(i(".tgmpa.wrap .subsubsub")),i("form#tgmpa-plugins .wp-list-table tbody tr").each(function(e,r){var a=i(r),s=a.find("td.type.column-type"),n=a.find(".rey-tgmpaNeedReg");s.length&&"Required"===s.text()&&a.addClass("--required"),n.length&&a.find('input[type="checkbox"]').prop("disabled",!0)});var o=function(){void 0!==i.fn.masonry&&e.masonry("layout")},r=i('body[class*="_page_rey-settings"]'),a=i("#postbox-container-2",r);i("#publishing-action",r).detach().prependTo(a);i(".js-dashDeregister").on("click",function(e){e.preventDefault();var s=i(this);s.addClass("rey-adminBtn--disabled"),i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_dashboard_deregister",security:reyAdminParams.ajax_dashboard_nonce},success:function(e){e&&(e.success&&1==e.success?(s.text(reyAdminParams.dashboard_strings.deregister_success),setTimeout(function(){location.reload()},2e3)):s.removeClass("rey-adminBtn--disabled"))},error:function(e,r,a){s.removeClass("rey-adminBtn--disabled"),console.error(e),console.error(r),console.error(a)}})}),i(".js-dashBox-registerForm").on("submit",function(e){e.preventDefault();var r=i(this),s=r.find(".rey-adminBtn");i(".rWizard-response").remove(),s.addClass("rey-adminBtn--disabled --loading"),i.ajax({method:"post",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_dashboard_register",security:reyAdminParams.ajax_dashboard_nonce,rey_purchase_code:i('input[name="rey_purchase_code"]',r).val(),rey_email_address:i('input[name="rey_email_address"]',r).val(),rey_subscribe_newsletter:i('input[name="rey_subscribe_newsletter"]',r).val()},success:function(e){s.removeClass("--loading"),e&&(e.success&&1==e.success?(s.text(reyAdminParams.dashboard_strings.reloading_text),setTimeout(function(){location.reload()},2e3)):s.removeClass("rey-adminBtn--disabled").text(reyAdminParams.dashboard_strings.default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+e.data+"</p>"))},error:function(e,r,a){s.removeClass("rey-adminBtn--disabled").removeClass("--loading").text(reyAdminParams.dashboard_strings.default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.dashboard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})});var d=function(e){var r=/{("success"[^}]+)}/g.exec(e);return!(!r||!r.length)&&JSON.parse(r[0])};i(".js-dashBox-installRequired").on("click",function(e){e.preventDefault();var s=i(this);s.addClass("rey-adminBtn--disabled").text(reyAdminParams.dashboard_strings.installing_btn_text),i(".reyAdmin-reqPlugin.--inactive:not(.--uninstallable)",s.closest(".rey-dashBox-content")).addClass("--is-installing"),i(".reyAdmin-response").remove();var r=new URL(window.location.href).searchParams.get("page")||"",n=function(){i.ajax({method:"get",url:reyAdminParams.ajax_url,dataType:"text",cache:!1,data:{action:"rey_dashboard_install_plugins",security:reyAdminParams.ajax_dashboard_nonce,page:r},success:function(e){o();var r=d(e);if(r)if(r.success&&!0===r.success&&!1!==r.data){var a=s.closest(".rey-dashBox-content");i(".reyAdmin-reqPlugin[data-slug='"+r.data+"']",a).removeClass("--is-installing --inactive").addClass("--is-active"),n()}else s.text(reyAdminParams.dashboard_strings.reloading_text),setTimeout(function(){location.reload()},2e3);else s.text(reyAdminParams.dashboard_strings.default_install_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+r.data+"</p>")},error:function(e,r,a){o(),s.text(reyAdminParams.dashboard_strings.default_install_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.dashboard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})};n()}),i(".js-subscribeNewsletterForm").on("submit",function(e){e.preventDefault();var r=i(this),s=r.find(".rey-adminBtn");i(".rWizard-response").remove(),s.addClass("rey-adminBtn--disabled --loading"),i.ajax({method:"post",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_dashboard_newsletter_subscribe",security:reyAdminParams.ajax_dashboard_nonce,rey_email_address:i('input[name="rey_email_address"]',r).val()},success:function(e){s.removeClass("--loading"),e&&(e.success&&1==e.success?(s.text(reyAdminParams.dashboard_strings.reloading_text),setTimeout(function(){location.reload()},2e3)):s.removeClass("rey-adminBtn--disabled").text(reyAdminParams.dashboard_strings.subscribe_default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+e.data+"</p>"))},error:function(e,r,a){s.removeClass("rey-adminBtn--disabled").removeClass("--loading").text(reyAdminParams.dashboard_strings.subscribe_default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.dashboard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})}),i(".js-installChild").on("click",function(e){e.preventDefault();var s=i(this);s.addClass("rey-adminBtn--disabled --loading"),i.ajax({method:"post",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_dashboard_install_child",security:reyAdminParams.ajax_dashboard_nonce},success:function(e){s.removeClass("--loading"),e&&e.success&&(s.text(reyAdminParams.dashboard_strings.copying_settings),i.ajax({method:"post",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_dashboard_migrate_opts_child",security:reyAdminParams.ajax_dashboard_nonce},success:function(e){s.removeClass("--loading"),e&&e.success&&(s.text(reyAdminParams.dashboard_strings.reloading_text),setTimeout(function(){location.reload()},2e3))}}))},error:function(e,r,a){s.removeClass("rey-adminBtn--disabled").removeClass("--loading").text(reyAdminParams.dashboard_strings.installing_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.dashboard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})}),i(".js-childCopySettings").on("click",function(e){e.preventDefault(),i(this).addClass("rey-adminBtn--disabled --loading")});var s=i('body[class*="_page_rey-setup-wizard"]'),c=i(".rey-wizard-wrapperInner",s),l=i(".rWizard-step",s),m=i(".js-rWizard-registrationForm",s),u=i(".rey-adminBtn.rey-adminBtn-primary",m),_=i(".js-skipWizard",s),y=function(e,r){l.removeClass("--active"),l.eq(e).fadeOut(300),l.eq(r).addClass("--active"),c.height(l.eq(r).outerHeight())},p=i(".rWizard-step--1.--registered",s).length?1:0;1===p&&(p=i(".rWizard-step--2.--plugins-installed",s).length?2:1),l.eq(p).addClass("--active"),c.height(l.eq(p).outerHeight()).css("opacity",1),m.on("submit",function(e){e.preventDefault(),i(".rWizard-response").remove(),u.addClass("--loading").text(reyAdminParams.wizard_strings.registering_btn_text),i.ajax({method:"post",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_register_purchase_code",security:reyAdminParams.ajax_wizard_nonce,rey_purchase_code:i('input[name="rey_purchase_code"]',m).val(),rey_email_address:i('input[name="rey_email_address"]',m).val(),rey_subscribe_newsletter:i('input[name="rey_subscribe_newsletter"]',m).val()},success:function(e){if(u.removeClass("--loading"),e)if(e.success&&1==e.success){var r=i(".js-reyAdmin-reqPlugins");r.addClass("--loading"),i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_wizard_get_required_plugins_markup",security:reyAdminParams.ajax_wizard_nonce},success:function(e){e.success&&1==e.success&&r.empty().html(e.data),r.removeClass("--loading"),y(0,1)},error:function(e,r,a){console.error(e),console.error(r),console.error(a)}})}else u.text(reyAdminParams.wizard_strings.default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+e.data+"</p>")},error:function(e,r,a){u.removeClass("--loading").text(reyAdminParams.wizard_strings.default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.wizard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})}),i(".js-skipRegistration",s).on("click",function(e){e.preventDefault(),y(0,1),c.addClass("--skipped-registration")}),i(".js-backRegistration",s).on("click",function(e){e.preventDefault(),l.removeClass("--active"),l.eq(0).addClass("--active").fadeIn(),c.height(l.eq(0).outerHeight()).removeClass("--skipped-registration")}),i(".js-rWizard-btnStep-2",s).on("click",function(e){e.preventDefault();var s=i(this),a=s.closest(".rWizard-step"),r=i("#wizardInstallChild").prop("checked");s.addClass("rey-adminBtn--disabled").text(reyAdminParams.wizard_strings.installing_btn_text),r&&(i("#wizardInstallChild").prop("disabled"),i(".rWizard-installChild",a).addClass("--is-installing")),i(".reyAdmin-reqPlugin.--inactive:not(.--uninstallable)",a).addClass("--is-installing"),i(".reyAdmin-response").remove();var n=new URL(window.location.href).searchParams.get("page")||"",t=function(){i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,dataType:"text",data:{action:"rey_wizard_install_plugins",security:reyAdminParams.ajax_wizard_nonce,page:n,child_theme:r},success:function(e){var r=d(e);r?r.success&&!0===r.success&&!1!==r.data&&"child_theme"!==r.data?(i(".reyAdmin-reqPlugin[data-slug='"+r.data+"']",a).removeClass("--is-installing --inactive").addClass("--is-active"),t()):(y(1,2),i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_wizard_skip",security:reyAdminParams.ajax_wizard_nonce},success:function(e){e&&e.success&&1==e.success&&_.css("opacity",0)},error:function(e,r,a){console.error(e),console.error(r),console.error(a)}}),i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_wizard_enable_child_theme",security:reyAdminParams.ajax_wizard_nonce},error:function(e,r,a){console.error(e),console.error(r),console.error(a)}})):s.text(reyAdminParams.wizard_strings.default_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+r.data+"</p>")},error:function(e,r,a){s.text(reyAdminParams.wizard_strings.default_install_btn_text).parent().before("<p class='reyAdmin-response reyAdmin-notice --error'>"+reyAdminParams.wizard_strings.something_went_wrong+"</p>"),console.error(e),console.error(r),console.error(a)}})};t()}),_.on("click",function(e){e.preventDefault();var r=i(this);r.addClass("rey-adminBtn--disabled --loading"),i.ajax({method:"get",url:reyAdminParams.ajax_url,cache:!1,data:{action:"rey_wizard_skip",security:reyAdminParams.ajax_wizard_nonce},success:function(e){e&&e.success&&1==e.success&&(r.text(reyAdminParams.wizard_strings.skipping_success),setTimeout(function(){window.location.href=reyAdminParams.dashboard_url},2e3))},error:function(e,r,a){console.error(e),console.error(r),console.error(a)}})}),i("#dashbox-search-kb").on("keyup",function(e){if(13==e.keyCode){var r=e.target.value.trim().replace(/ /g,"+");window.open("https://support.reytheme.com/?source=kb&s="+r,"_blank").focus()}})}(jQuery);