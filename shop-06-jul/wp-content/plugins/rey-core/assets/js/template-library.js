!function(d){"use strict";if("undefined"!=typeof elementor&&"undefined"!==elementorCommon){new function(e){var r=this;this.data={},this.internal_data={},this.activeData=!1,this.activePanel=!1,this.totalItems=0,this.categories={},this.gridSize=30,this.supportedTypes=["pages"],this.options=d.extend({},e||{}),this.errorDialog=!1,this.templatesJson=!!reyTemplatesLibraryParams.api_url&&reyTemplatesLibraryParams.api_url+"templates_library.json",this.columnsPerPanel={headers:2,footers:3},this.ls={set:function(e,t,a){if(e&&t&&a){var s={value:t,expires_at:(new Date).getTime()+a/1};localStorage.setItem(e.toString(),JSON.stringify(s))}},get:function(e){if(!e)return null;var t=JSON.parse(localStorage.getItem(e.toString()));if(null!==t){if(!(null!==t.expires_at&&t.expires_at<(new Date).getTime()))return t.value;localStorage.removeItem(e.toString())}return null}},this.elements={$body:d(document.body),$templatePanelScript:d("#tmpl-elementor-add-section")},this.templates={modal:wp.template("elementor-rey-templates-modal"),items:wp.template("elementor-rey-templates-modal-item"),nav:wp.template("elementor-rey-templates-modal-nav"),empty:wp.template("elementor-rey-templates-modal-empty")},this.init=function(){this.templatesJson&&this.elements.$templatePanelScript.length&&this.addTriggerButton()},this.getSlugFromId=function(a){var s="";return d.each(this.data.items,function(e,t){void 0!==t.sku&&parseInt(t.sku)===parseInt(a)&&(s=e)}),s},this.doModal=function(){void 0===this.$modal&&(this.$modal=elementorCommon.dialogsManager.createWidget("lightbox",{id:"rey-templates-modal",headerMessage:"",message:r.templates.modal,className:"elementor-templates-modal rey-templates",hide:{auto:!1,onClick:!1,onOutsideClick:!1,onOutsideContextMenu:!1,onBackgroundClick:!0},position:{my:"center",at:"center"}}),this.initApp()),this.$modal.show()},this.initApp=function(){this.elements.$modalContent=this.$modal.getElements("message"),this.elements.$tpModal=d(".rey-tpModal",this.elements.$modalContent),this.defaultCols=parseInt(this.elements.$tpModal.attr("data-columns"))||4,this.elements.$headerNav=d(".tpModal-headerNav",this.elements.$modalContent),this.elements.$headerLogo=d(".tpModal-headerLogo",this.elements.$modalContent),this.elements.$search=d('.headerBar-search input[type="search"]',this.elements.$modalContent),this.elements.$modalLoader=d(".js-tpModal-loading",this.elements.$modalContent),this.elements.$content=d(".js-tpModal-content",this.elements.$modalContent),this.elements.$title=d(".headerBar-title",this.elements.$modalContent),this.elements.$favoritesBtn=d(".headerTools-favorites",this.elements.$modalContent),this.elements.$installedBtn=d(".headerTools-installed",this.elements.$modalContent),this.elements.$syncBtn=d(".tpModal-headerSync",this.elements.$modalContent),this.panelSize={w:this.elements.$modalContent.width(),h:this.elements.$modalContent.height()},this.elements.$changeList=d(".js-headerBar-changeView",this.elements.$modalContent),this.elements.$sortList=d(".js-headerBar-sort",this.elements.$modalContent),this.getTemplateData(),this.events(),d(document).trigger("reycore/template_library/init",[this])},this.getTemplateData=function(e){var t=this;if(!0!==e&&this.ls.get("rey_library_data"))return this.data=this.ls.get("rey_library_data"),void this.runApp();d.ajax({dataType:"json",url:t.templatesJson,cache:!1,success:function(s){s&&void 0!==s.data&&(s.data.categories={},d.each(s.data.items,function(e,a){var t=a.categories.indexOf(a.cat);-1!==t&&s.data.items[e].categories.splice(t,1),void 0===s.data.categories[a.cat]&&(s.data.categories[a.cat]={}),d.each(a.categories,function(e,t){s.data.categories[a.cat][t]=t.replace(/-/gi," ")})}),t.data=s.data,t.ls.set("rey_library_data",t.data,864e5),t.runApp(),e&&t.elements.$syncBtn.removeClass("--syncing"))},error:function(e,t,a){console.error(e),console.error(t),console.error(a)}})},this.getInternalData=function(){void 0!==reyTemplatesLibraryParams.internal_data&&(this.internal_data=reyTemplatesLibraryParams.internal_data,void 0!==this.internal_data.favorites&&this.elements.$favoritesBtn.attr("data-count",this.internal_data.favorites.length))},this.changeColumns=function(e){this.elements.$tpModal.attr("data-columns",e),this.elements.$changeList.val(e),this.loadItems()},this.sortPipe=function(s){var n=this.activeData?this.activeData:this.data.items,a={};return s=s||this.elements.$sortList.val(),Object.keys(n).sort(function(e,t){if("newest"!==s)return n[e].p[s]<n[t].p[s]?1:n[e].p[s]>n[t].p[s]?-1:0;var a=new Date(n[e].d);return new Date(n[t].d)-a}).map(function(e,t){a[e]=n[e]}),this.activeData?this.activeData=a:this.data.items=a,a},this.doSort=function(e,t){var a=this.sortPipe(e);t&&this.populatePanel(a),d(".headerBar-sortWhich",this.elements.$tpModal).text(d('option[value="'+e+'"]',this.elements.$sortList).text())},this.runApp=function(){this.getInternalData(),this.makeNavigation(),this.populatePanel(this.getFeaturedItems(),this.activePanel)},this.populatePanel=function(e,t,a){if(this.elements.$content.empty(),this.activeData=e||!1,this.activePanel=t||!1,d.isEmptyObject(e)){var s=this.templates.empty();d(s).appendTo(this.elements.$content)}else{var n=this.templates.items({items:this.sortPipe(),internal_data:this.internal_data});d(n).appendTo(this.elements.$content),this.changeColumns(a||this.defaultCols),this.item_events()}this.loader.hide()},this.loadItems=function(){var s=this,e=d(".tpModal-item.--loading",this.elements.$content);if(e.length){var n=new IntersectionObserver(function(e){d.each(e,function(e,t){if(0<t.intersectionRatio){n.unobserve(t.target);var a=d("img",t.target);a.attr("src",a.attr("data-src")).on("load",function(){d(t.target).removeClass("--loading"),s.resizeGridItem(t.target)})}})},{root:s.elements.$content[0],rootMargin:"50px 0px",threshold:.01});d.each(e,function(e,t){n.observe(t)})}},this.getFeaturedItems=function(){var a={};return d.each(r.data.items,function(e,t){void 0!==t.feat&&t.feat&&(a[e]=t)}),a},this.resizeGridItem=function(e){var t=this.elements.$content.children(".tpModal-contentInner")[0],a=parseInt(window.getComputedStyle(t).getPropertyValue("grid-auto-rows")),s=parseInt(window.getComputedStyle(t).getPropertyValue("grid-row-gap")),n=Math.ceil((e.querySelector(".tpModal-itemInner").getBoundingClientRect().height+(this.gridSize-s))/(a+s));e.style.gridRowEnd="span "+n},this.resizeAllGridItems=function(){var a=this;d(".tpModal-item",this.elements.$content).each(function(e,t){a.resizeGridItem(t)})},this.insertTemplate=function(e,a){var s=r.getSlugFromId(e),t={unique_id:e,data:d.extend({source:"rey",edit_mode:!0,display:!0,template_id:e,page_settings:!1,template_slug:s},a||{}),success:function(e){var t=new Backbone.Model({getTitle:function(){return"Importing"}});elementor.channels.data.trigger("template:before:insert",t),elementor.getPreviewView().addChildModel(e.content),elementor.channels.data.trigger("template:after:insert",{}),a.page_settings&&elementor.settings.page.model.setExternalChange(e.page_settings),r.afterTemplateImport(s)},error:function(e){r.alertDialog.showDialog(e)},complete:function(){r.loader.hide(),d('.tpModal-itemInsert[data-sku="'+e+'"]',r.elements.$modalContent).addClass("--active"),setTimeout(function(){r.$modal.hide()},500)}};return elementorCommon.ajax.addRequest("get_template_data",t)},this.afterTemplateImport=function(e){var t=elementor.settings.page.getSettings();void 0!==r.internal_data.installed&&void 0===r.internal_data.installed[e]&&r.internal_data.installed.push(e),"template-builder.php"!==t.settings.template&&elementor.settings.page.model.setExternalChange({template:"template-builder.php"})},this.changeTitle=function(e){this.elements.$title.html(e)},this.events=function(){var n=this;this.elements.$changeList.on("change",function(e){n.populatePanel(n.activeData,n.activePanel,e.target.value)}),this.elements.$search.on("input",this.debounce(function(e){var t=e.target.value,a={},s=new RegExp(t,"gi");n.loader.show(),""!==t?(d.each(n.data.items,function(e,t){(t.k.match(s)||t.name.match(s)||t.url.match(s))&&(a[e]=t)}),n.populatePanel(a,"search"),n.changeTitle(reyTemplatesLibraryParams.strings.searching+' <span class="u-normal-text">"'+e.target.value+'"</span>')):n.populatePanel()},400)),this.elements.$sortList.on("change",function(e){n.doSort(e.target.value,!0)}),d(".js-tpModal-headerClose",this.elements.$modalContent).on("click",function(e){e.preventDefault(),n.$modal.hide()}),this.elements.$favoritesBtn.on("click",function(e){e.preventDefault();var t=d(this),a={};n.loader.show(),d.each(n.internal_data.favorites,function(e,t){void 0!==n.data.items[t]&&(a[t]=n.data.items[t])}),n.populatePanel(a,"favorites"),t.addClass("--active"),d(".headerNav-list a[data-category]",n.elements.$tpModal).removeClass("--active"),n.elements.$installedBtn.removeClass("--active"),n.elements.$headerLogo.removeClass("--active"),n.changeTitle(t.text())}),this.elements.$headerLogo.on("click",function(e){e.preventDefault(),n.loader.show(),n.populatePanel(n.data.items),d(this).addClass("--active"),d(".headerNav-list a[data-category]",n.elements.$tpModal).removeClass("--active"),n.elements.$installedBtn.removeClass("--active"),n.elements.$favoritesBtn.removeClass("--active"),n.changeTitle(reyTemplatesLibraryParams.strings.browse)}),this.elements.$syncBtn.on("click",function(e){e.preventDefault(),d(this).addClass("--syncing"),n.loader.show(),n.getTemplateData(!0),n.makeNavigation(),n.elements.$headerLogo.trigger("click")}),this.elements.$installedBtn.on("click",function(e){e.preventDefault();var t=d(this),a={};n.loader.show(),void 0!==n.internal_data.installed?(d.each(n.internal_data.installed,function(e,t){a[t]=n.data.items[t]}),n.populatePanel(a,"installed")):n.populatePanel({},"installed"),t.addClass("--active"),d(".headerNav-list a[data-category]",n.elements.$tpModal).removeClass("--active"),n.elements.$favoritesBtn.removeClass("--active"),n.elements.$headerLogo.removeClass("--active"),n.changeTitle(t.text())})},this.makeNavigation=function(){void 0!==this.elements.$headerNavList&&this.elements.$headerNavList.remove();var e=this.templates.nav(this.data.categories);this.elements.$headerNavList=d(e).appendTo(this.elements.$headerNav),d("a[data-category]",this.elements.$headerNavList).on("click",function(e){e.preventDefault();var t=d(this),a=t.parent().is("li"),s=t.attr("data-category"),n=t.text(),i={};d.each(r.data.items,function(e,t){a?t.cat===s&&(i[e]=t):-1!==t.categories.indexOf(s)&&(i[e]=t)});var o=void 0!==r.columnsPerPanel[s]?r.columnsPerPanel[s]:r.defaultCols;if(r.populatePanel(i,s,o),t.closest("ul").find("a").removeClass("--active"),t.addClass("--active"),!a){var l=t.closest("li").children("a");l.addClass("--active"),n=l.text()+" » "+t.text()}r.elements.$favoritesBtn.removeClass("--active"),r.elements.$installedBtn.removeClass("--active"),r.elements.$headerLogo.removeClass("--active"),r.changeTitle(n),""!==r.elements.$search.val()&&r.elements.$search.val("")})},this.item_events=function(){var o=this;d(".tpModal-itemFav",this.elements.$modalContent).on("click",function(e){e.preventDefault();var s=d(this),n=s.hasClass("--active");o.loader.show(),void 0!==reyTemplatesLibraryParams.ajax_url&&void 0!==reyTemplatesLibraryParams.ajax_nonce&&d.ajax({method:"post",url:reyTemplatesLibraryParams.ajax_url,data:{action:"add_remove_favorites",security:reyTemplatesLibraryParams.ajax_nonce,slug:s.attr("data-slug")},success:function(e){if(e&&e.success&&void 0!==e.data){var t=parseInt(o.elements.$favoritesBtn.attr("data-count"));if(n){if(s.addClass("--removed"),s.removeClass("--active"),o.elements.$favoritesBtn.attr("data-count",t-1),"favorites"===o.activePanel){var a={};d.each(e.data,function(e,t){a[t]=o.data.items[t]}),o.populatePanel(a,"favorites")}}else s.addClass("--added"),o.elements.$favoritesBtn.attr("data-count",t+1);o.internal_data.favorites=e.data,o.loader.hide()}},error:function(e,t,a){console.error(e),console.error(t),console.error(a)}})}),d(".tpModal-itemInsert",this.elements.$modalContent).on("click",function(e){e.preventDefault();var t=d(this),a=o.data.items[t.attr("data-slug")],s=a.sku,n=function(){o.loader.show(reyTemplatesLibraryParams.strings.downloading),o.insertTemplate(s,{page_settings:!1})};if(void 0!==a.req){var i={};d.each(a.req,function(e,t){void 0!==reyTemplatesLibraryParams.req_strings[t]&&(i[e]=reyTemplatesLibraryParams.req_strings[t])}),o.alertDialog.showDialog(i,function(){n()},"Please know the following:")}else n()}),d("[data-template-tooltip]",this.elements.$modalContent).on("mouseenter",function(e){if(!d(".rey-tpl-tooltip").length){var t=!0,a=d(this),s=a.attr("data-template-tooltip");try{var n=JSON.parse(s)}catch(e){t=!1}t&&(s=a.hasClass(n.switcher_class)?n.active_text:n.text),d('<div class="rey-tpl-tooltip"></div>').text(s).appendTo("body").fadeIn("fast")}}).on("mousemove",function(e){var t=document.querySelector(".rey-tpl-tooltip"),a=t.offsetWidth,s=t.offsetHeight,n=a/2,i=s+15;e.pageX>.8*o.panelSize.w&&(n=a),e.pageY<.2*o.panelSize.h&&(i=-1*s),d(".rey-tpl-tooltip").css({top:e.pageY-i,left:e.pageX-n})}).on("mouseleave",function(e){d(".rey-tpl-tooltip").remove()})},this.addTriggerButton=function(){var e=this,t=this.elements.$templatePanelScript.text();t=t.replace('<div class="elementor-add-section-drag-title','<div class="elementor-add-section-area-button js-rey-templatesButton rey-templatesButton" title="Rey Templates">'+reyTemplatesLibraryParams.logo+'</div><div class="elementor-add-section-drag-title'),this.elements.$templatePanelScript.text(t),elementor.on("preview:loaded",function(){if(d(elementor.$previewContents[0].body).on("click",".js-rey-templatesButton",function(){e.doModal()}),void 0!==elementor.elements&&!elementor.elements.length&&d("html").is('[data-post-type="rey-global-sections"]')){var a=d("html").attr("data-gs")||"",s={header:"headers",footer:"footers",cover:"cover-page-headers"};a in s&&(d(document).on("reycore/template_library/init",function(e,t){d('.headerNav-list a[data-category="'+s[a]+'"]',t.elements.$tpModal).trigger("click")}),e.doModal())}})},this.loader={class:"--visible",show:function(e){e&&d("<h4>"+e+"</h4>").appendTo(r.elements.$modalLoader),r.elements.$modalLoader.addClass(this.class)},hide:function(){d("h4",r.elements.$modalLoader).remove(),r.elements.$modalLoader.removeClass(this.class)}},this.alertDialog={errorDialog:null,showDialog:function(e,t,a){if("object"==typeof e){var s="";d.each(e,function(e,t){s+="<div>"+t+"</div>"}),e=s}else e?e+=".":e="<i>&#60;The error message is empty&#62;</i>";this.getDialog(t,a).setMessage("<div>"+e+"</div>").show()},getDialog:function(e,t){if(!this.errorDialog){var a={id:"rey-templates-modal-error-dialog",headerMessage:t||reyTemplatesLibraryParams.strings.an_error_occurred};e&&(a.onConfirm=e),this.errorDialog=elementorCommon.dialogsManager.createWidget("alert",a)}return this.errorDialog}},this.confirmationDialog={dialog:null,showImportDialog:function(e,t){var a=this.getDialog();a.onConfirm=e,a.onCancel=t,a.show()},initDialog:function(){this.dialog=elementorCommon.dialogsManager.createWidget("confirm",{id:"rey-templates-modal-confirm-dialog",headerMessage:elementor.translate("import_template_dialog_header"),message:elementor.translate("import_template_dialog_message")+"<br>"+elementor.translate("import_template_dialog_message_attention"),strings:{confirm:elementor.translate("yes"),cancel:elementor.translate("no")}})},getDialog:function(){return this.dialog||this.initDialog(),this.dialog}},this.debounce=function(t,a,s){var n,i,o,l,r,d=function(){var e=Date.now-l;e<a&&0<=e?n=setTimeout(d,a-e):(n=null,s||(r=t.apply(o,i),n||(o=i=null)))};return function(){o=this,i=arguments,l=Date.now;var e=s&&!n;return n||(n=setTimeout(d,a)),e&&(r=t.apply(o,i),o=i=null),r}},this.init()}}}(jQuery);