!function(l,c){"use strict";var e={containerSelector:"#rey-customizer-search",init:function(){this.customizerWrapper=l("#customize-controls"),this.customizerPanels=l("#customize-theme-controls",this.customizerWrapper),this.customizerSectionThemes=l("#accordion-section-themes",this.customizerWrapper),this.customizerInfo=l("#customize-info",this.customizerWrapper),this.addSearchForm(),this.searchInput=l('input[type="search"]',this.containerSelector),this.searchResults=l('<div class="rey-customizerSearch-results"><ul class="rey-searchResults"></ul></div>').insertAfter(this.customizerPanels),this.resultsTemplate=wp.template("rey-customizer-search-results"),this.indexControls(),this.events()},events:function(){var i=this;l(this.searchInput,document).on("input",function(e){e.preventDefault();var t=l(e.target).val();0<t.length?i.displayMatches(t):i.clearSearch()}).on("focus",function(e){i.activateSearchView()}),l(".rey-customizerSearch-cancel",this.containerSelector).on("click",function(){i.deactivateSearchView()}),this.customizerPanels.on("click",function(){i.customizerWrapper.hasClass("--focused")&&i.deactivateSearchView()})},addSearchForm:function(){this.customizerWrapper.addClass("--rey-search");var e=wp.template("rey-customizer-search-form");l(this.containerSelector).length||this.customizerInfo.after(e())},activateSearchView:function(){this.customizerWrapper.addClass("--focused"),this.customizerPanels.animate({opacity:.5},500),this.customizerSectionThemes.slideUp("fast"),this.customizerInfo.slideUp("fast")},deactivateSearchView:function(){this.customizerWrapper.removeClass("--focused"),this.customizerPanels.animate({opacity:1},500),this.customizerSectionThemes.slideDown("fast"),this.customizerInfo.slideDown("fast"),this.clearSearch(!0)},indexControls:function(){this.controls=l.map(_wpCustomizeSettings.controls,function(s,e){return l.map(_wpCustomizeSettings.sections,function(i,e){s.section==i.id&&l.map(_wpCustomizeSettings.panels,function(e,t){""==i.panel&&(s.panelName=i.title),i.panel==e.id&&(s.sectionName=i.title,s.panel=i.panel,s.panelName=e.title)})}),[s]}),this.controls=this.controls.filter(function(e){return-1===["widgets","themes","nav_menus"].indexOf(e.panel)})},expandSection:function(e){},displayMatches:function(r){var o=this,e=this.findMatches(r);if(e.length){var t=e.map(function(e,t){if(""!==e.label){var i=e.label;i=i.replace(/&quot;/g,'"');var s=new RegExp(r,"gi"),n='<span class="hl">'+r+"</span>",c=e.description,a=l("<div></div>").html(i);return c=l("<div></div>").html(c).text(),a.find(".rey-csTitleHelp-title").length&&(i=a.find(".rey-csTitleHelp-title").html(),c=a.find(".rey-csTitleHelp-content").text()),i=i.replace(s,n),c=c.replace(s,n),o.resultsTemplate({section:e.section,label:i,description:c,panelName:e.panelName,sectionName:e.sectionName,controlId:e.id})}});this.customizerWrapper.addClass("--hide-panels"),this.searchResults.children("ul").html(t),l(".rey-searchResult",this.searchResults).on("click",function(e){var t=l(this),i=t.attr("data-section"),s=t.attr("data-control"),n=c.section(i);o.deactivateSearchView(),n.expand({completeCallback:function(){c.control(s,function(e){e.deferred.embedded.done(function(){c.previewer.deferred.active.done(function(){e.focus(),e.container.addClass("--focus-control"),setTimeout(function(){e.container.removeClass("--focus-control")},1500)})})})}})})}},findMatches:function(i){return this.controls.filter(function(e){null==e.panelName&&(e.panelName=""),null==e.sectionName&&(e.sectionName="");var t=new RegExp(i,"gi");return e.label.match(t)||e.panelName.match(t)||e.sectionName.match(t)})},clearSearch:function(e){this.customizerWrapper.removeClass("--hide-panels"),this.searchResults.children("ul").html(""),this.searchInput.val(""),!0!==e&&this.searchInput.focus()}};c.bind("ready",function(){e.init()})}(jQuery,wp.customize);