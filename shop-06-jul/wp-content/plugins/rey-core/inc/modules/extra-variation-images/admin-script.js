!function(o){"use strict";var a=function(){this.variation_ids=[],this.init=function(){this.$variations=o("#variable_product_options .woocommerce_variation"),this.getVariationIDs(),this.getVariationImages(),this.events()},this.getVariationImages=function(){if(this.variation_ids.length){var e=this,r=wp.template("rey-extra-images-admin");o.post({url:reyEviParams.ajax_url,data:{action:"rey_get_extra_variation_images_admin",security:reyEviParams.ajax_nonce,variation_ids:e.variation_ids},success:function(a){Object.keys(a.data).length?(o.each(a.data,function(a,i){var t=o('a.upload_image_button[rel="'+a+'"]',e.$variations);t.next(".rey-extraVariationsImages").length||t.after(r({variation_id:a,variation_images:i}))}),e.runSortable()):console.warn("empty")},error:function(a,i,t){console.error(a),console.error(i),console.error(t)}})}},this.getVariationIDs=function(){var i=this;o.each(this.$variations,function(){var a=o(this).find("a.upload_image_button").prop("rel");i.variation_ids.push(a)})},this.runSortable=function(){var t=this;o(".rey-extraVariationsImages").each(function(a,i){o(".rey-extraVariationsImages-list",i).sortable({update:function(){t.prepThumbs(o(i).attr("data-variation-id"))},placeholder:"sortable-placeholder",cursor:"move"})})},this.prepThumbs=function(a){if(a){var e=[],i=o('.rey-extraVariationsImages[data-variation-id="'+a+'"]'),t=o("input.js-rey-extraVariationsImages-save",i),r=o(".rey-extraVariationsImages-list li",i);r.length?(r.each(function(a,i){var t=o("a",i).attr("data-id");t&&e.push(t)}),e.join(",").replace(/,,/gi,",")):e="",t.val(e),o("#variable_product_options input").first().change(),i.parents(".woocommerce_variation").first().addClass("variation-needs-update")}},this.events=function(){var n=this;this.$variations.on("click",".rey-extraVariationsImages-btn",function(a){a.preventDefault();var i=o(this).parent(".rey-extraVariationsImages"),t=i.attr("data-variation-id"),e=o(".rey-extraVariationsImages-list",i),r=!1;!1===r&&(r=wp.media.frames.mediaFrame=wp.media({title:reyEviParams.media_title,button:{text:reyEviParams.media_button_text},library:{type:"image"},multiple:!0})).on("select",function(){r.state().get("selection").map(function(a){if((a=a.toJSON()).id){var i=a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;e.append('<li><a href="#" data-id="'+a.id+'"><img src="'+i+'" /></a></li>')}}),wp.media.model.settings.post.id=t,n.runSortable(),n.prepThumbs(t)}),r.open()}),this.$variations.on("click",".rey-extraVariationsImages-list > li > a",function(a){a.preventDefault();var i=o(this),t=i.closest(".rey-extraVariationsImages").attr("data-variation-id");i.parent("li").remove(),n.prepThumbs(t)})},this.init()};o(document).ready(function(){o.reyWcExtraVariationImages=new a,o("body").on("woocommerce_variations_added woocommerce_variations_loaded",function(){o.reyWcExtraVariationImages=new a})})}(jQuery);